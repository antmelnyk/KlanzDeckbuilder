class Deck

  constructor: ->
    @head = -1
    @cards = []

  add_card: (card) =>
    if card in @cards
      alert('Дубли в деке запрещены клерками!')
      return false
    else
      @cards.push card
      @head++
      return true

  remove_card: (bad_card) =>
    @cards = @cards.filter (card) -> card isnt bad_card
    @head--

$(document).ready ->
  deck = new Deck()
  deck_input = ''
  $(document).on "click", ".outdeck-card", ->
    card = $(this).attr('id')
    deckable = deck.add_card card
    if deckable
      deck_input = $('input[name="deck[deck]"]')[0].value = deck_input + card + '_'
      $(this).removeClass('outdeck-card')
      $(this).addClass('deck-card')
      toggle_to_deckholder($(this))
      $(this).detach().fadeIn('slow');
      $('.deckholder').append($(this))

  $(document).on "click", ".deck-card", ->
    chosen = $(this).attr('id')
    deck.remove_card(chosen)
    $(this).removeClass('deck-card')
    $(this).addClass('outdeck-card')
    toggle_to_list($(this))
    $(this).detach().fadeIn('slow');
    $('#cards').append($(this))

  $('#clear-all').click ->
    location.reload()

  $('.btn-primary').click ->
    if deck.head < 14
      alert('В деке должно быть минимум 15 карт, сладенький!')

  toggle_to_deckholder = (card) ->
    card.find($('.art')).toggleClass('deckholder-art art')
    card.find($('.main-line')).toggleClass('deckholder-main-line main-line')
    card.find($('.power-bg')).toggleClass('deckholder-power-bg power-bg')
    card.find($('.power')).toggleClass('deckholder-power power')
    card.find($('.damage-bg')).toggleClass('deckholder-damage-bg damage-bg')
    card.find($('.damage')).toggleClass('deckholder-damage damage')
    card.find($('.stats')).toggleClass('deckholder-stats stats')
    card.find($('.ability')).toggleClass('deckholder-ability ability')
    card.find($('.long-ability')).toggleClass('deckholder-long-ability long-ability')
    card.find($('.long-name')).toggleClass('deckholder-long-name long-name')
    card.find($('.bonus')).toggleClass('deckholder-bonus bonus')

  toggle_to_list = (card) ->
    card.find($('.deckholder-art')).toggleClass('art deckholder-art')
    card.find($('.deckholder-main-line')).toggleClass('main-line deckholder-main-line')
    card.find($('.deckholder-power-bg')).toggleClass('power-bg deckholder-power-bg')
    card.find($('.deckholder-power')).toggleClass('power deckholder-power')
    card.find($('.deckholder-damage-bg')).toggleClass('damage-bg deckholder-damage-bg')
    card.find($('.deckholder-damage')).toggleClass('damage deckholder-damage')
    card.find($('.deckholder-stats')).toggleClass('stats deckholder-stats')
    card.find($('.deckholder-ability')).toggleClass('ability deckholder-ability')
    card.find($('.deckholder-long-ability')).toggleClass('long-ability deckholder-long-ability')
    card.find($('.deckholder-long-name')).toggleClass('long-name deckholder-long-name')
    card.find($('.deckholder-bonus')).toggleClass('bonus deckholder-bonus')

